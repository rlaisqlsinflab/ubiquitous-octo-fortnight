# 프롬프트 템플릿 수정 UI 가이드

## 📍 개요

이 가이드는 코스 설명 빌더에서 **프롬프트 템플릿**을 수정하는 방법을 설명합니다.

---

## 🎯 프롬프트(템플릿) 수정 플로우

### **Step 1: 템플릿 패널 열기**

```
┌─────────────────────────────────────────────┐
│  코스 설명 빌더 인터페이스                    │
│                                              │
│  [저장] [미리보기] [템플릿]                   │
│                              ↑              │
│                          클릭!              │
└─────────────────────────────────────────────┘
```

- 상단 도구모음에서 **"템플릿"** 버튼 클릭
- 우측 패널에 템플릿 드로어가 열림

### **Step 2: My 탭 선택**

```
┌────────────────────────┐
│ 템플릿 패널             │
├──────────┬──────────────┤
│ 기본 템플릿  │  My      │  ← My 탭 클릭
├────────────────────────┤
│                        │
│ 내 템플릿 목록:         │
│ • 템플릿 A    (✏️ 🗑️)   │
│ • 템플릿 B    (✏️ 🗑️)   │
│ • 템플릿 C    (✏️ 🗑️)   │
│                        │
└────────────────────────┘
```

- 우측 패널 상단의 **"My"** 탭 클릭
- 저장된 나의 템플릿 목록 표시

### **Step 3: 편집 아이콘 클릭**

```
┌────────────────────────┐
│ My                     │
├────────────────────────┤
│ 템플릿 A      [✏️ 🗑️]  │
│ YY.MM.DD              │
│                        │
│ ↓ 마우스 오버 시       │
│ 아이콘 표시됨          │
│                        │
│ 템플릿 B      [✏️ 🗑️]  │
│ YY.MM.DD              │
│                        │
│ ✏️ ← 이 아이콘 클릭    │
└────────────────────────┘
```

**주의사항:**
- 템플릿 위에 마우스를 올리면 편집/삭제 아이콘이 나타남
- ✏️(편집) 아이콘 클릭

### **Step 4: 제목 수정 모달 열기**

```
┌──────────────────────────────┐
│ 템플릿 제목 수정              │
├──────────────────────────────┤
│                              │
│ [새 템플릿 이름]              │
│ (최대 17자)                   │
│ 입력 중... (8/17)             │
│                              │
├──────────────────────────────┤
│ [취소]  [내용 포함 저장]  [제목만 저장] │
└──────────────────────────────┘
```

모달에서 **두 가지 저장 옵션** 제공:

---

## 🔄 두 가지 저장 방식

### **방식 1️⃣ "제목만 저장"** (버튼: 우측)

**상황:**
- 템플릿 이름만 변경하고 싶을 때
- 에디터의 콘텐츠는 변경 없음

**동작:**
```
제목 입력 → [제목만 저장] 클릭
    ↓
API 호출: PUT /api/v1/internal/course/description/templates/{templateKey}
요청: { "title": "새로운 이름" }
    ↓
템플릿 이름 업데이트 ✅
```

**예시:**
```
기존: "강사 스토리형 강의 소개"
변경: "더 나은 강의 소개 템플릿"
    → 오직 이름만 변경됨
```

---

### **방식 2️⃣ "내용 포함 저장"** (버튼: 중앙)

**상황:**
- 템플릿 이름 + 현재 에디터의 모든 콘텐츠를 저장하고 싶을 때
- 에디터에서 새로운 레이아웃 또는 구조를 만들었을 때

**동작:**
```
제목 입력 → [내용 포함 저장] 클릭
    ↓
1. 현재 에디터 상태 직렬화:
   - 에디터의 CraftJS JSON 추출
   - lz-string으로 압축

2. API 호출: PUT /api/v1/internal/course/description/templates/{templateKey}
   요청: {
     "title": "새로운 이름",
     "jsonBody": "lz-encoded JSON",
     "htmlBody": "렌더링된 HTML"
   }

3. 이전 버전 자동 저장:
   - 변경 전 템플릿 → history 배열에 저장

4. 새로운 버전으로 업데이트 ✅
```

**예시:**
```
변경 전:
- 텍스트 + 이미지 섹션 2개
- 비디오 1개

변경 후 (에디터에서):
- 3단 레이아웃 섹션
- 텍스트 + 이미지 + 비디오
- 정보박스 추가

→ [내용 포함 저장] 클릭하면:
  새로운 구조가 템플릿으로 저장되고,
  이전 구조는 히스토리에 저장됨
```

---

## 💾 저장된 템플릿 활용

### **1️⃣ 템플릿 적용**

저장된 템플릿을 다시 사용하려면:

```
1. 템플릿 패널 열기 → My 탭
2. 원하는 템플릿 선택 (클릭)
3. "템플릿 적용" 확인 모달 표시
4. 확인하면 → 에디터에 템플릿 구조 적용됨
```

### **2️⃣ 변경 이력 확인**

과거 버전을 확인하려면:

```
API: GET /api/v1/internal/course/description/templates/{templateKey}/history

응답:
{
  "totalHistory": 3,
  "history": [
    {
      "version": 3,
      "updatedAt": "2024-01-15T14:20:00Z",
      "promptCount": 4,
      "exampleCount": 5
    },
    {
      "version": 2,
      "updatedAt": "2024-01-14T09:15:00Z",
      ...
    },
    ...
  ]
}
```

---

## ⚠️ 주의사항

### **제목 입력 규칙**
- ✅ 최대 17자까지 입력 가능
- ✅ 공백 포함 계산
- ❌ 빈 칸만으로는 저장 불가능
- ❌ 18자 이상 입력 불가능 (자동 제한)

### **저장 후**
- ✅ "템플릿이 수정되었습니다" 알림 표시
- ✅ 모달 자동 닫힘
- ✅ My 탭의 업데이트된 시간 표시

### **에러 상황**
```
❌ "템플릿을 찾을 수 없습니다"
   → 템플릿이 삭제되었거나 접근 권한 없음

❌ "템플릿 정보를 입력해주세요"
   → 필수 정보(제목 또는 콘텐츠) 누락

❌ "네트워크 오류"
   → 인터넷 연결 확인 후 다시 시도
```

---

## 🎬 완전한 사용 예시

### **시나리오: 강의 소개 템플릿 개선**

```
1. 기존 "강사 스토리형" 템플릿을 선택
2. 에디터에 적용 → 강의 소개 콘텐츠 작성 시작
3. 레이아웃을 더 나은 구조로 개선:
   - 헤더 추가
   - 섹션 재배열
   - 스타일 개선
4. 완성된 새 구조를 템플릿으로 저장:
   - 템플릿 패널 → My 탭
   - 기존 "강사 스토리형" 템플릿 선택 → ✏️
   - 제목을 "개선된 강사 스토리" 로 변경
   - [내용 포함 저장] 클릭
5. 완료!
   - 새로운 구조 저장됨
   - 이전 구조는 히스토리에 보관됨
   - 앞으로 "개선된 강사 스토리" 템플릿으로 다른 강의에도 사용 가능
```

---

## 📚 API 상호작용 흐름

```
사용자 인터페이스
       ↓
   [✏️ 편집 클릭]
       ↓
MyTemplateSaveModal
(제목 입력 받음)
       ↓
   [제목만 저장] 또는 [내용 포함 저장]
       ↓
MyTemplateButtonWrapper
(updateTemplate 또는 updateTemplateContent 호출)
       ↓
useEditorData 훅 (필요시)
(generateJson(), generateHTML() 실행)
       ↓
templateService.ts
(API 요청 생성)
       ↓
PUT /api/v1/internal/course/description/templates/{templateKey}
       ↓
Backend
(이전 버전 저장 + 새 버전 업데이트)
       ↓
성공 응답
       ↓
화면에 알림 표시
모달 자동 닫힘
```

---

## 🔗 관련 코드

### **주요 컴포넌트**
- **MyTemplateSaveModal**: 제목 입력 및 저장 방식 선택
  - 위치: `src/components/TemplateManager/my/MyTemplateSaveModal.tsx`

- **MyTemplateButtonWrapper**: 편집/삭제 버튼 관리
  - 위치: `src/components/TemplateManager/my/MyTemplateButtonWrapper.tsx`

### **서비스 함수**
- **updateTemplatePrompt()**: 템플릿 업데이트 API 호출
  - 위치: `src/hooks/useEditorData/templateService.ts`

### **타입 정의**
- **UpdateTemplateContent**: 템플릿 콘텐츠 수정 타입
  - 위치: `src/components/TemplateManager/context/MyTemplateApiContext.tsx`

---

## ✅ 체크리스트

프롬프트 템플릿 수정 전 확인사항:

- [ ] 템플릿 패널 열렸는가? (우측 드로어)
- [ ] My 탭을 선택했는가?
- [ ] 마우스를 템플릿에 올려서 아이콘이 표시되는가?
- [ ] ✏️ 아이콘을 클릭했는가?
- [ ] 제목을 17자 이내로 입력했는가?
- [ ] 저장 방식을 선택했는가?
- [ ] 성공 알림이 표시되었는가?

---

**마지막 업데이트**: 2024-01-20
**버전**: 1.0.0
